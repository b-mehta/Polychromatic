# Polychromatic Colourings in Lean

A formalisation of polychromatic colourings of integers in the Lean theorem prover

This repository aims to formalise results related to polychromatic colourings of integers. Given a
finite set `S` of integers, a colouring of the integers is called `S`-polychromatic if every
translate of `S` contains an element of each colour class.
A primary target is to show that for any set `S` of size 4, there is an `S`-polychromatic colouring
in 3 colours.

The repository structure is as follows:
- `Generation`: C++, Python and Z3 code which generates explicit colourings for certain sets
- `Lean`: Lean formal proofs of the results
- `Verso`: Lean code to generate the website
- `site`: A partial Jekyll website, which completed by the code in `Verso`

## Prerequisites

### For Lean Builds
- [Elan](https://github.com/leanprover/elan) - Lean version manager
  ```bash
  curl https://elan.lean-lang.org/elan-init.sh -sSf | sh
  ```

### For Generation Code
- A C++ compiler with OpenMP support (e.g., GCC)
- Python 3 with dependencies from `requirements.txt`:
  ```bash
  pip install -r requirements.txt
  ```

### For Website Build
- Ruby 3.1+ with Bundler
- Jekyll (installed via Bundler)

## Build Instructions

### Generating Colouring Log Files

The `Generation` directory contains tools to generate explicit polychromatic colourings for
quadruples of integers. These files are required by the Lean build.

#### Generating `temp-colors.log`

This file is generated by the C++ program, which searches for periodic colourings using
backtracking. Compile and run with:

```bash
cd Generation
g++ -O3 -fopenmp coloring-integers.cpp -o coloring-integers
./coloring-integers > temp-colors.log 2>&1
```

Note: This process tests all quadruples `(0, a, b, c)` where `c â‰¤ 288` and may take a significant
amount of time to complete. The `-fopenmp` flag enables parallel execution to speed up the search.

#### Generating `full-colors.log`

The Python script `fill_in_blanks.py` takes the output from `temp-colors.log` and fills in any
cases where the C++ program couldn't find a colouring (indicated by a period of -1), using the
Z3 SMT solver:

```bash
cd Generation
python fill_in_blanks.py
```

This reads `temp-colors.log` and writes the completed results to `full-colors.log`.

### Building the Lean Proofs

**IMPORTANT**: Before building, you must download the pre-compiled mathlib cache to avoid
a 60+ minute build time. The colouring log files from the Generation step above must also be
present.

```bash
cd Lean
lake exe cache get  # Download mathlib cache (required!)
lake build          # Build the project
```

For incremental builds after making changes:
```bash
cd Lean
lake build
```

### Building the Verso Documentation

Verso generates web documentation from the Lean code. It requires building the highlighted
Lean files first:

```bash
# Build highlighted Lean files
cd Lean
lake exe cache get
lake build :highlighted

# Generate documentation
cd ../Verso
lake exe docs
```

The output is written to the `site/_pages/` directory.

### Building the Jekyll Website

After generating the Verso documentation:

```bash
cd site
bundle install
bundle exec jekyll build --destination ../_site --baseurl "/Polychromatic"
```

For local development with live reload:
```bash
cd site
bundle exec jekyll serve
```

The site will be available at `http://localhost:4000/Polychromatic/`.

### Building API Documentation

To generate the full API documentation using doc-gen4:

```bash
cd Lean
lake exe cache get
../scripts/build_docs.sh
```

The documentation will be generated in `Lean/docbuild/.lake/build/doc`.